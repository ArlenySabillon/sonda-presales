var PagoControlador=function(){function n(n){this.mensajero=n;this.ordenDeVentaServicio=new OrdenDeVentaServicio;this.taareaServicio=new TareaServcio;this.clienteServicio=new ClienteServicio;this.manejoDeDecimalesServicio=new ManejoDeDecimalesServicio;this.pagoServicio=new PagoServicio;this.listaDeSkuDeVenta=[];this.tokenCliente=n.subscribe(this.clienteEntregado,getType(ClienteMensaje),this);this.tokenTarea=n.subscribe(this.tareaEntregado,getType(TareaMensaje),this);this.tokenListaOrdenDeVenta=n.subscribe(this.listaDeSkuDeVentaEntregado,getType(ListaSkuMensaje),this);this.tokenPago=n.subscribe(this.pagoEntregado,getType(PagoMensaje),this)}return n.prototype.clienteEntregado=function(n,t){t.cliente=n.cliente},n.prototype.tareaEntregado=function(n,t){t.tarea=n.tarea;t.esReimpresion=!1},n.prototype.listaDeSkuDeVentaEntregado=function(n,t){t.listaDeSkuDeVenta=n.listaSku;t.listaSkuOrdenDeVentaPrincipal=[];t.listaDeOrdnesDeVEntaCf=[];t.listaDeSkuParaBonificacion=n.listaDeSkuParaBonificacion},n.prototype.pagoEntregado=function(n,t){t.pago=n.pago;t.pago===null||t.pago===undefined?(t.imagen1=null,t.imagen2=null,t.tipoDePago=TipoDePago.Efectivo):(t.imagen1=t.pago.pagoDetalle[0].image1,t.imagen2=t.pago.pagoDetalle[0].image2,t.tipoDePago=t.pago.pagoDetalle[0].paymentType)},n.prototype.delegadoPagoControlador=function(){var n=this;$(document).on("pagebeforechange",function(t,i){i.toPage==="UiPagePayment"&&(n.cliente=i.options.data.cliente,n.tarea=i.options.data.tarea,n.configuracionDecimales=i.options.data.configuracionDecimales,n.pago=i.options.data.pago,n.cargarPantalla(n),$.mobile.changePage("#UiPagePayment"))});$("#UiBotonListadoDeFormaDePago").bind("touchstart",function(){n.usuarioSeleccionoFormaDePago()});document.addEventListener("backbutton",function(){n.usuarioDeseaVerPantallaAnterior()},!0);$("#UiBotonAtrasFormaDePago").on("click",function(){n.usuarioDeseaVerPantallaAnterior()});$("#UiBotonAceptarFormaDePago").on("click",function(){n.usuarioSelecionoAceptarFormaDePago(n)});$("#UiBotonImagenFrontal").on("click",function(){n.usuarioDeseaTomarImagen(TipoDeFoto.Frontal,n)});$("#UiBotonImagenTrasera").on("click",function(){n.usuarioDeseaTomarImagen(TipoDeFoto.Trasera,n)})},n.prototype.usuarioDeseaVerPantallaAnterior=function(){var n=$("#UiTextoNumeroDeDocumentoDeCheque"),t=$("#UiEtiquetaFormaDePagoSeleccionada");n.text("");t.text("Efectivo");switch($.mobile.activePage[0].id){case"UiPagePayment":$.mobile.changePage("#SalesOrderSummaryPage",{transition:"flow",reverse:!0,changeHash:!1,showLoadMsg:!1})}n=null;t=null},n.prototype.obtenerConfiguracionDeDecimales=function(){var n=this;this.manejoDeDecimalesServicio.obtenerInformacionDeManejoDeDecimales(function(t){n.configuracionDecimales=t},function(n){notify(n.mensaje)})},n.prototype.usuarioSeleccionoFormaDePago=function(){var i=this,n=[],t;n.push({text:"Efectivo",value:TipoDePago.Efectivo.toString()});n.push({text:"Cheque",value:TipoDePago.Cheque.toString()});t={title:"Forma de Pago",items:n,doneButtonLabel:"Ok",cancelButtonLabel:"Cancelar"};ShowListPicker(t,function(n){i.mostrarOpcionDeTipoDePago(n.toString(),"")})},n.prototype.usuarioSelecionoAceptarFormaDePago=function(n){var t=$("#UiTextoNumeroDeDocumentoDeCheque"),i;n.tipoDePago===TipoDePago.Cheque&&(t.val().trim()===""||n.imagen1===null)?notify("Debe ingresar el numero de documento y tomar la imagen frontal"):n.pago===null||n.pago===undefined?(i=t.val(),n.pagoServicio.formarPagoUnicoDesdeLista(n.cliente,n.listaDeSkuDeVenta,n.tipoDePago,i,n.imagen1,n.imagen2,function(i){n.pago=i;n.pago.pagoDetalle[0].documentNumber=t.val();n.publicarListaDeSkuOrdenDeVenta();n.publicarTarea();n.publicarPago();$.mobile.changePage("#SalesOrderSummaryPage",{transition:"flow",reverse:!0,changeHash:!1,showLoadMsg:!1});t.val("");t=null},function(n){notify(n.mensaje);t.val("");t=null})):(n.tipoDePago===TipoDePago.Cheque?(n.pago.pagoDetalle[0].paymentType=TipoDePago.Cheque.toString(),n.pago.pagoDetalle[0].documentNumber=t.val(),n.pago.pagoDetalle[0].image1=n.imagen1,n.pago.pagoDetalle[0].image2=n.imagen2):(n.pago.pagoDetalle[0].paymentType=TipoDePago.Efectivo.toString(),n.pago.pagoDetalle[0].documentNumber=null,n.pago.pagoDetalle[0].image1=null,n.pago.pagoDetalle[0].image2=null),n.publicarListaDeSkuOrdenDeVenta(),n.publicarTarea(),n.publicarPago(),$.mobile.changePage("#SalesOrderSummaryPage",{transition:"flow",reverse:!0,changeHash:!1,showLoadMsg:!1}),t.val(""),t=null)},n.prototype.publicarTarea=function(){var n=new TareaMensaje(this);n.tarea=this.tarea;this.mensajero.publish(n,getType(TareaMensaje))},n.prototype.publicarListaDeSkuOrdenDeVenta=function(){var n=new ListaSkuMensaje(this);n.listaSku=this.listaDeSkuDeVenta;n.listaDeSkuParaBonificacion=this.listaDeSkuDeVenta;this.mensajero.publish(n,getType(ListaSkuMensaje))},n.prototype.publicarPago=function(){var n=new PagoMensaje(this);n.pago=this.pago;this.mensajero.publish(n,getType(PagoMensaje))},n.prototype.mostrarOpcionDeTipoDePago=function(n,t){var i=$("#UiEtiquetaFormaDePagoSeleccionada"),r=$("#UiListaDePagoConCheque"),u=$("#UiTextoNumeroDeDocumentoDeCheque");switch(n){case TipoDePago.Efectivo.toString():this.tipoDePago=TipoDePago.Efectivo;i.text("Efectivo");r.hide();break;case TipoDePago.Cheque.toString():this.tipoDePago=TipoDePago.Cheque;i.text("Cheque");u.text(t);r.show()}i=null;r=null;u=null},n.prototype.usuarioDeseaTomarImagen=function(n,t){navigator.camera.getPicture(function(i){$("#uiFotoTomada").attr("src","data:image/jpeg;base64,"+i);$("#uiDivFotoTomada").css("visibility","visible");switch(n){case TipoDeFoto.Frontal:t.imagen1=i;break;case TipoDeFoto.Trasera:t.imagen2=i}},function(n){notify("Error al tomar la foto,"+n)},{quality:90,targetWidth:350,targetHeight:350,saveToPhotoAlbum:!1,sourceType:Camera.PictureSourceType.CAMERA,correctOrientation:!0,destinationType:Camera.DestinationType.DATA_URL})},n.prototype.cargarPantalla=function(n){n.pago===null||n.pago===undefined?(n.imagen1=null,n.imagen2=null,n.tipoDePago=TipoDePago.Efectivo):(n.imagen1=n.pago.pagoDetalle[0].image1,n.imagen2=n.pago.pagoDetalle[0].image2,n.tipoDePago=n.pago.pagoDetalle[0].paymentType);n.pago===null||n.pago===undefined?n.mostrarOpcionDeTipoDePago(TipoDePago.Efectivo.toString(),""):n.mostrarOpcionDeTipoDePago(n.pago.pagoDetalle[0].paymentType,n.pago.pagoDetalle[0].documentNumber)},n}();