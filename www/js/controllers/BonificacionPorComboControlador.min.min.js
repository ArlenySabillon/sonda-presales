var BonificacionPorComboControlador=function(){function n(n){this.mensajero=n;this.bonoServicio=new BonoServicio;this.usuarioPuedeModificarBonificacionDeCombo=!1;this.tokenCombo=n.subscribe(this.bonificacionPorCombo,getType(BonoPorComboMensaje),this)}return n.prototype.delegarBonificacionPorComboControlador=function(){var n=this;document.addEventListener("backbutton",function(){n.usuarioDeseaVerPantallaAnterior()},!0);$(document).on("pagebeforechange",function(t,i){i.toPage==="UiPageBonusByCombo"&&(n.listaDeSkuBonificacionPorCombo=i.options.data.listaDeSkuBonificacionPorCombo,n.indice=i.options.data.indice,n.cargarPantalla(),$.mobile.changePage("#UiPageBonusByCombo"))});$("#uiBtnAceptarBonificacionDeCombo").on("click",function(){n.validarSkusBonificacion(function(){n.publicarBonoPorCombo(n.listaDeSkuBonificacionPorCombo,n.indice,function(){n.usuarioDeseaVerPantallaAnterior()})},function(n){notify(n.mensaje)})});$("#uiBtnCancelarBonificacionDeCombo").on("click",function(){n.usuarioDeseaRetornarAListadoDeVenta()})},n.prototype.cargarSkusBonificacionPorCombo=function(){var i,n,o,u,s,t,f;try{my_dialog("Cargando...","Cargando lista de SKUs bonificados, por favor, espere...","open");i=$("#uiListaSkuBonificacionCombo");i.children().remove("li");var r=!this.listaDeSkuBonificacionPorCombo.isConfig,e=$("#UiLblComboBonificacion"),h=$("#etiquetaPrincipalCombos");for(this.listaDeSkuBonificacionPorCombo.bonusSubType===SubTipoDeBonificacionPorCombo.Multiple.toString()?(e.html(this.listaDeSkuBonificacionPorCombo.nameCombo+" <br>"+DescripcionSubTipoDeBonificacionPorCombo.Multiple.toString()),h.html("Debe de escoger por lo menos una bonificaci\u00f3n"),r=!1):(h.html("Solo puede escoger una bonificaci\u00f3n"),e.html(this.listaDeSkuBonificacionPorCombo.nameCombo+"<br>Bonificaci\u00f3n "+DescripcionSubTipoDeBonificacionPorCombo.Unica.toString())),n='<li data-icon="false">',n+='<table name="'+this.listaDeSkuBonificacionPorCombo.comboId+'" id= "'+this.listaDeSkuBonificacionPorCombo.comboId+'" data-role="table" data-mode="reflow" class="ui-responsive table-stroke">',o=0,u=0,s=this.listaDeSkuBonificacionPorCombo.skusDeBonoPorCombo;u<s.length;u++)t=s[u],n+="<tr>",n+='<td style="width: 15%">',n+='<input type="',n+=this.listaDeSkuBonificacionPorCombo.bonusSubType===SubTipoDeBonificacionPorCombo.Multiple.toString()?"checkbox":"radio",n+='" class="configuracionBonificacionPorCombo" name="eleccionDeBonificacionPorCombo" id="e'+t.codeSku+"|"+t.codePackUnit+'" value="'+t.codeSku+"|"+t.codePackUnit+"|"+t.qty+"|"+o+'" ',n+=r||t.isCheacked||!this.usuarioPuedeModificarBonificacionDeCombo&&this.listaDeSkuBonificacionPorCombo.bonusSubType===SubTipoDeBonificacionPorCombo.Multiple.toString()?'checked="checked" ':"",n+=!this.usuarioPuedeModificarBonificacionDeCombo&&this.listaDeSkuBonificacionPorCombo.bonusSubType===SubTipoDeBonificacionPorCombo.Multiple.toString()?"disabled />":"/>",n+="<\/td>",n+='<td style="width: 90%;word-wrap: break-word;word-break: break-all;">',n+="<p>"+t.codeSku+"<\/p><p>"+t.descriptionSku+"<\/p><p>"+t.descriptionPackUnit+"<\/p>",this.usuarioPuedeModificarBonificacionDeCombo===!1?n+="<p class='small-roboto id='cant"+t.codeSku+"|"+t.codePackUnit+"'>"+t.qty+"<\/p>":(f=localStorage.getItem("USE_MAX_BONUS")==="1"?t.qty:"",f=t.isCheacked?t.selectedQty:f,n+="<input class='configuracionBonificacionPorComboCantidad ui-input-text ui-body-inherit ui-corner-all ui-shadow-inset' type='number' pattern='[0-9]*' id='cant"+t.codeSku+t.codePackUnit+"' value='"+f+"' placeholder='Bonificacion Maxima "+t.qty+"'/>"),n+="<\/td>",n+="<\/tr>",r&&(r=!1),o++;this.usuarioPuedeModificarBonificacionDeCombo&&this.listaDeSkuBonificacionPorCombo.bonusSubType===SubTipoDeBonificacionPorCombo.Unica.toString()&&(n+="<tr>",n+='<td style="width: 15%">',n+='<input type="radio" class="configuracionBonificacionPorCombo" name="eleccionDeBonificacionPorCombo" id="none" value="none" '+(this.listaDeSkuBonificacionPorCombo.isConfig&&this.listaDeSkuBonificacionPorCombo.isEmpty?'checked="checked" ':"")+"/>",n+="<\/td>",n+='<td style="width: 60%">',n+="<span>Ninguno<\/span>",n+="<\/td>",n+="<\/tr>");n+="<\/table><\/li>";i.append(n);i.listview("refresh");n=null;e=null;i=null;my_dialog("","","close")}catch(c){my_dialog("","","close");notify("No se ha podido cargar la lista de SKUs a bonificar debido a: "+c.message)}},n.prototype.usuarioDeseaVerPantallaAnterior=function(){switch($.mobile.activePage[0].id){case"UiPageBonusByCombo":this.usuarioDeseaRetornarAListadoDeVenta()}},n.prototype.usuarioDeseaRetornarAListadoDeVenta=function(){window.history.back()},n.prototype.bonificacionPorCombo=function(n,t){t.listaDeSkuBonificacionPorCombo=n.bonoPorCombo;t.indice=n.indice},n.prototype.publicarBonoPorCombo=function(n,t,i){var r=new BonoPorComboMensaje(this);r.bonoPorCombo=n;r.indice=t;this.mensajero.publish(r,getType(BonoPorComboMensaje));i()},n.prototype.validarSkusBonificacion=function(n,t){var i=this;try{this.colocarComoNoSelecionado(function(){var o=[],r,f="",h=!0,s,u,e;if(i.listaDeSkuBonificacionPorCombo.bonusSubType===SubTipoDeBonificacionPorCombo.Multiple.toString())$('input[type="checkbox"]').filter(".configuracionBonificacionPorCombo").map(function(n,u){var c=u,e,s;if(c.checked)if(e=c.value.split("|"),s=parseInt(e[ComboBonoParser.CantidadMaxima]),r=i.listaDeSkuBonificacionPorCombo.skusDeBonoPorCombo[e[ComboBonoParser.Indice]],i.usuarioPuedeModificarBonificacionDeCombo&&(f=obtenerValorDeObjeto("cant"+e[ComboBonoParser.CodigoDeSku]+e[ComboBonoParser.UnidadDeMedida]),s=f===""?0:parseInt(f)),s>0&&s<=parseInt(e[ComboBonoParser.CantidadMaxima]))r.selectedQty=s,r.isCheacked=!0,o.push(r),e.length=0,r=null,i.listaDeSkuBonificacionPorCombo.isEmpty=!1;else if(s!==0){h=!1;t({codigo:-1,mensaje:"Error: La cantidad ingresada debe ser entre 1 y "+e[ComboBonoParser.CantidadMaxima]});return}c=null});else{if(s=$("input[name=eleccionDeBonificacionPorCombo]:checked"),s.val()==="none")i.listaDeSkuBonificacionPorCombo.isEmpty=!0;else if(u=s.val().split("|"),e=parseInt(u[ComboBonoParser.CantidadMaxima]),r=i.listaDeSkuBonificacionPorCombo.skusDeBonoPorCombo[u[ComboBonoParser.Indice]],i.usuarioPuedeModificarBonificacionDeCombo&&(f=obtenerValorDeObjeto("cant"+u[ComboBonoParser.CodigoDeSku]+u[ComboBonoParser.UnidadDeMedida]),e=f===""?0:parseInt(f)),e>0&&e<=parseInt(u[ComboBonoParser.CantidadMaxima]))r.selectedQty=e,r.isCheacked=!0,o.push(r),u.length=0,r=null,i.listaDeSkuBonificacionPorCombo.isEmpty=!1;else return t({codigo:-1,mensaje:"Error: La cantidad ingresada debe de estar entre 1 y "+u[ComboBonoParser.CantidadMaxima]}),h=!1,!1;s=null}h&&(o.length>0?i.listaDeSkuBonificacionPorCombo.skusDeBonoPorComboAsociados=o:i.listaDeSkuBonificacionPorCombo.isEmpty=!0,i.listaDeSkuBonificacionPorCombo.isConfig=!0,n())})}catch(r){t({codigo:-1,mensaje:"Error al validar configuracion: "+r.message})}},n.prototype.colocarComoNoSelecionado=function(n){this.listaDeSkuBonificacionPorCombo.skusDeBonoPorCombo.map(function(n){n.isCheacked=!1});n()},n.prototype.cargarPantalla=function(){var n=this;this.bonoServicio.validarSiModificaBonificacionPorCombo(function(t){n.usuarioPuedeModificarBonificacionDeCombo=t;n.cargarSkusBonificacionPorCombo()},function(t){n.usuarioPuedeModificarBonificacionDeCombo=!1;notify("Error al validar si puede modificar la bonificacion por combo: "+t.mensaje)})},n}();