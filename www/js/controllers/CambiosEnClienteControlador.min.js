var CambiosEnClienteControlador=function(){function n(n){this.mensajero=n;this.viendoMapa=!1;this.clienteServicio=new ClienteServicio;this.tokenCliente=n.subscribe(this.clienteEntregado,getType(ClienteMensaje),this)}return n.prototype.clienteEntregado=function(n,t){t.cliente=n.cliente},n.prototype.delegarCambiosEnClienteControlador=function(){var n=this;document.addEventListener("backbutton",function(){n.usuarioDeseaRegresarAPaginaAnterior()},!0);$("#UiPageCustomerInfo").on("pageshow",function(){n.limpiarCamposDeModificarCliente(function(){n.clienteServicio.obtenerEtiquetas(n.cliente,function(t){n.cliente=t;n.cargarInformacionDeCliente();n.cargarEtiquetasDeCliente(n.cliente);n.cargarEtiquetasRestantes()},function(n){notify(n.mensaje)})})});$("#UiBotonCancelarModificarCliente").bind("touchstart",function(){n.usuarioDeseaRegresarAPaginaAnterior()});$("#UiPageCustomerInfo").on("swipeleft","#UiModificacionDeClienteListaEtiquetas li",this.usuarioDeseaEliminarEtiqueta);$("#UiPageCustomerInfo").on("swiperight",function(){var n=$.mobile.activePage.children('[id="UiModificarClientePanelDeEtiquetas"]');n.panel("toggle")});$("#UiBotonObtnerGpsDeModificarCliente").bind("touchstart",function(){n.usuarioDeseaObtenerGps()});$("#UiBotonMostarMapaDeModificarCliente").bind("touchstart",function(){n.usuarioDeseaVerMapa()});$("#UiBotonAceptarModificarCliente").bind("touchstart",function(){n.usuarioDeseaGuardarCambiosDeCliente()})},n.prototype.usuarioDeseaRegresarAPaginaAnterior=function(){switch($.mobile.activePage[0].id){case"UiPageCustomerInfo":if(this.viendoMapa===!1)navigator.notification.confirm("¿Está Seguro de abandonar la modificación del cliente?",function(n){n===2&&window.history.back()},"Sonda® "+SondaVersion,"No,Si");else{this.viendoMapa=!1;var n=$("#UiModificarClienteDatosGenerales"),t=$("#UiModificarClienteMapa");n.show();t.hide();n=null;t=null}}},n.prototype.cargarInformacionDeCliente=function(){var u=$("#UiEtiquetaModificacionDeClienteCodigoDeCliente"),n,t,i,r;u.text(this.cliente.clientId);u=null;n=$("#UiEtiquetaModificacionDeClienteNombreDeCliente");n.text(this.cliente.clientName);n=null;t=$("#UiModificacionDeClienteDireccion");t.val(this.cliente.address);t=null;i=$("#UiModificacionDeClienteContacto");i.val(this.cliente.contactCustomer);i=null;r=$("#UiModificacionDeClienteTelefono");r.val(this.cliente.phone);r=null},n.prototype.cargarEtiquetasDeCliente=function(n){var i,u;try{for(i=$("#UiModificacionDeClienteListaEtiquetas"),i.children().remove("li"),u=0;u<n.etiquetas.length;u++){var r=n.etiquetas[u],f=" <li id='"+r.tagColor.substring(1,r.tagColor.length).toString()+"' data-icon='false; class='ui-field-contain ui-alt-icon ui-nodisc-icon ui-shadow ui-icon-check' style='background-color:"+r.tagColor+";' >",e="",t=r.tagColor;t=t.replace(/^\s*#|\s*$/g,"");t.length==3&&(t=t.replace(/(.)/g,"$1$1"));var o=parseInt(t.substr(0,2),16),s=parseInt(t.substr(2,2),16),h=parseInt(t.substr(4,2),16),c=2.99*o+5.87*s+1.14*h;e=c>=1275?"#000000":"#FFFFFF";f+="<FONT color='"+e+"'>";f+=r.tagValueText;f+="<\/FONT><\/li>";i.append(f);i.listview("refresh")}i=null}catch(l){notify("Error al cargar las etiquetas del cliente: "+l.message)}},n.prototype.cargarEtiquetasRestantes=function(){var n=this;this.clienteServicio.obtenerEtiquetasNoAsociadasAlCliente(this.cliente,function(t){n.etiquetas=t;n.cargarEtiquetasNoAsociadasCliente(t)},function(n){notify(n.mensaje)})},n.prototype.cargarEtiquetasNoAsociadasCliente=function(n){var r,u;try{for(r=$("#UiModificarClienteListadoDeEtiquetas"),r.children().remove("li"),u=0;u<n.length;u++){var i=n[u],o="usuarioDeseaAgregarEtiqueta('"+i.tagColor.substring(1,i.tagColor.length).toString()+"')",f=" <li id='"+i.tagColor.substring(1,i.tagColor.length).toString()+"' data-icon='false; class='ui-field-contain ui-alt-icon ui-nodisc-icon ui-shadow ui-icon-check' style='background-color:"+i.tagColor+";' onclick="+o+" >",e="",t=i.tagColor;t=t.replace(/^\s*#|\s*$/g,"");t.length==3&&(t=t.replace(/(.)/g,"$1$1"));var s=parseInt(t.substr(0,2),16),h=parseInt(t.substr(2,2),16),c=parseInt(t.substr(4,2),16),l=2.99*s+5.87*h+1.14*c;e=l>=1275?"#000000":"#FFFFFF";f+="<FONT color='"+e+"'>";f+=i.tagValueText;f+="<\/FONT><\/li>";r.append(f);r.listview("refresh")}r=null}catch(a){notify("Error al cargar las etiquetas no asociadas al cliente: "+a.message)}},n.prototype.limpiarCamposDeModificarCliente=function(n){var h=$("#UiEtiquetaModificacionDeClienteCodigoDeCliente"),t,i,r,u,f,e,o,s;h.text("...");h=null;t=$("#UiEtiquetaModificacionDeClienteNombreDeCliente");t.text("...");t=null;i=$("#UiModificacionDeClienteDireccion");i.text("");i=null;r=$("#UiModificacionDeClienteContacto");r.text("");r=null;u=$("#UiModificacionDeClienteTelefono");u.text("");u=null;f=$("#UiModificacionDeClienteListaEtiquetas");f.children().remove("li");f=null;e=$("#UiModificarClienteListadoDeEtiquetas");e.children().remove("li");e=null;this.viendoMapa=!1;o=$("#UiModificarClienteDatosGenerales");s=$("#UiModificarClienteMapa");o.show();s.hide();o=null;s=null;n()},n.prototype.usuarioDeseaEliminarEtiqueta=function(n){var t=this,r,u,i;if(n.type==="swipeleft"){for(n.preventDefault(),u="#"+$(this).attr("id"),i=0;i<t.cliente.etiquetas.length;i++)if(t.cliente.etiquetas[i].tagColor===u){r=t.cliente.etiquetas[i];t.cliente.etiquetas.splice(i,1);t.etiquetas.push(r);break}t.cargarEtiquetasDeCliente(t.cliente);t.cargarEtiquetasNoAsociadasCliente(t.etiquetas)}},n.prototype.usuarioDeseaAgregarEtiqueta=function(n){for(var i,t=0;t<this.etiquetas.length;t++)if(this.etiquetas[t].tagColor===n){i=this.etiquetas[t];this.etiquetas.splice(t,1);this.cliente.etiquetas.push(i);break}this.cargarEtiquetasDeCliente(this.cliente);this.cargarEtiquetasNoAsociadasCliente(this.etiquetas)},n.prototype.usuarioDeseaObtenerGps=function(){var n=this;ObtenerPosicionGPS(function(){n.cliente.gps=gCurrentGPS;ToastThis("GPS obtenido")})},n.prototype.usuarioDeseaVerMapa=function(){var n=this;ObtenerPosicionGPS(function(){n.cliente.gps=gCurrentGPS;n.viendoMapa=!0;var t=$("#UiModificarClienteDatosGenerales"),i=$("#UiModificarClienteMapa");t.hide();i.show();t=null;i=null;ToastThis("GPS obtenido")})},n.prototype.usuarioDeseaGuardarCambiosDeCliente=function(){navigator.notification.confirm("¿Está Seguro de guardar los cambios del cliente?",function(n){n===2&&notify("Guardar")},"Sonda® "+SondaVersion,"No,Si")},n}();