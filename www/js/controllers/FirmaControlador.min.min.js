var socketTareaDetalle,FirmaControlador=function(){function n(n){this.mensajero=n;this.tareaServicio=new TareaServcio;this.tokenFirma=n.subscribe(this.firmaEntregada,getType(FirmaMensaje),this)}return n.prototype.delegadoFirmaControlador=function(){var n=this;$("#UiUserSignaturPage").on("pageshow",function(){n.validarFirmaObligatoria(function(){n.prepararCanvas()})});$("#UiCancerlarFirma").bind("touchstart",function(){n.usuarioDeseaVerPantallaAnterior()});$("#UiLimpiarFirmaEnPantallaDeFirma").bind("touchstart",function(){n.pad.clear()});$("#UiGuardarFirma").bind("touchstart",function(){n.usuarioDeseaGuardarFoto(function(){n.usuarioDeseaVerPantallaAnterior()})});document.addEventListener("backbutton",function(){n.usuarioDeseaVerPantallaAnterior()},!0)},n.prototype.prepararCanvas=function(){var t=$("#UiUserSignaturPage"),n=document.querySelector("canvas[id=UiCanvasDeFirma]");n.height=t.innerHeight()-20;this.pad=new SignaturePad(n,{minWidth:1,maxWidth:2,penColor:"rgb(0, 0, 0)"});n=null;t=null},n.prototype.usuarioDeseaVerPantallaAnterior=function(){switch($.mobile.activePage[0].id){case"UiUserSignaturPage":switch(this.origen){case"SalesOrderSummaryPage":$.mobile.changePage("#SalesOrderSummaryPage")}}},n.prototype.usuarioDeseaGuardarFoto=function(n){var t=this;this.validarFirma(function(i){t.firma=i;t.publicarFirma();n()},function(n){notify(n.mensaje)})},n.prototype.validarFirma=function(n,t){this.firmaObligatoria?this.pad.isEmpty()?t({codigo:-1,mensaje:"La firma es obligatoria"}):n(this.pad.toDataURL()):n(this.pad.toDataURL())},n.prototype.firmaEntregada=function(n,t){t.firma=n.firma;t.origen=n.origen},n.prototype.publicarFirma=function(){var n=new FirmaMensaje(this);n.firma=this.firma;n.origen=this.origen;this.mensajero.publish(n,getType(FirmaMensaje))},n.prototype.validarFirmaObligatoria=function(n){var t=this;try{this.tareaServicio.obtenerRegla("FirmaObligatoriaEnOrdenDeVenta",function(i){t.firmaObligatoria=!1;i.length>=1&&i[0].enabled.toUpperCase()==="SI"&&(t.firmaObligatoria=!0);n()},function(n){notify(n.mensaje);t.firmaObligatoria=!1})}catch(i){notify("Error al validar si modifica DMG: "+i.message);this.firmaObligatoria=!1}},n}();