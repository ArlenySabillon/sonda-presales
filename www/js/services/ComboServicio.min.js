var ComboServicio=function(){function n(){}return n.prototype.obtenerSkusDeCombo=function(n,t,i){SONDA_DB_Session.transaction(function(i){var r="SELECT DISTINCT";r+=" SC.COMBO_ID";r+=" ,SC.CODE_SKU";r+=" ,SC.CODE_PACK_UNIT";r+=" ,P.DESCRIPTION_PACK_UNIT";r+=" ,SC.QTY";r+=" FROM SKU_BY_COMBO SC";r+=" INNER JOIN PACK_UNIT P";r+=" ON (SC.CODE_PACK_UNIT = P.CODE_PACK_UNIT)";r+=" WHERE SC.COMBO_ID = "+n.comboId;r+=" ORDER BY SC.COMBO_ID";i.executeSql(r,[],function(i,r){for(var f,u,o=[],e=0;e<r.rows.length;e++)f=r.rows.item(e),u=new SkuPorCombo,u.comboId=f.COMBO_ID,u.codeSku=f.CODE_SKU,u.codePackUnit=f.CODE_PACK_UNIT,u.descriptionPackUnit=f.DESCRIPTION_PACK_UNIT,u.qty=f.QTY,o.push(u);n.skusPorCombo=o;t(n)})},function(n){i({codigo:-1,mensaje:"Error al obtener los sku del combo: "+n.message})})},n.prototype.obtenerSkusDeComboParaBonificar=function(n,t,i){SONDA_DB_Session.transaction(function(i){var r="SELECT DISTINCT";r+=" BLCS.BONUS_LIST_ID";r+=" ,BLCS.COMBO_ID";r+=" ,BLCS.CODE_SKU";r+=" ,S.SKU_NAME DESCRIPTION_SKU";r+=" ,BLCS.CODE_PACK_UNIT";r+=" ,P.DESCRIPTION_PACK_UNIT";r+=" ,BLCS.QTY";r+=" ,BLCS.IS_MULTIPLE";r+=" ,S.OWNER";r+=" ,S.OWNER_ID";r+=" FROM BONUS_LIST_BY_COMBO_SKU BLCS";r+=" INNER JOIN SKU_PRESALE S";r+=" ON (BLCS.CODE_SKU = S.SKU)";r+=" INNER JOIN PACK_UNIT P";r+=" ON (BLCS.CODE_PACK_UNIT = P.CODE_PACK_UNIT)";r+=" WHERE BLCS.BONUS_LIST_ID = "+n.bonusListId;r+=" AND BLCS.COMBO_ID = "+n.comboId;r+=" ORDER BY BLCS.BONUS_LIST_ID,BLCS.COMBO_ID";i.executeSql(r,[],function(i,r){for(var f,u,o=[],e=0;e<r.rows.length;e++)f=r.rows.item(e),u=new SkuDeBonoPorCombo,u.bonusListId=f.BONUS_LIST_ID,u.comboId=f.COMBO_ID,u.codeSku=f.CODE_SKU,u.descriptionSku=f.DESCRIPTION_SKU,u.codePackUnit=f.CODE_PACK_UNIT,u.descriptionPackUnit=f.DESCRIPTION_PACK_UNIT,u.qty=f.QTY,u.isCheacked=!1,u.selectedQty=0,u.isMultiple=f.IS_MULTIPLE===1,u.originalQty=f.QTY,u.owner=f.OWNER,u.ownerId=f.OWNER_ID,o.push(u);n.skusDeBonoPorCombo=o;t(n)})},function(n){i({codigo:-1,mensaje:"Error al obtener el bonificaciones del combo: "+n.message})})},n.prototype.obtenerReglasDeBonificacionDeCombosPorCliente=function(n,t,i){SONDA_DB_Session.transaction(function(i){var r=[];r.push("SELECT DISTINCT");r.push(" BLC.BONUS_LIST_ID");r.push(" ,BLC.COMBO_ID");r.push(" ,BLC.BONUS_TYPE");r.push(" ,BLC.BONUS_SUB_TYPE");r.push(" ,BLC.IS_BONUS_BY_LOW_PURCHASE");r.push(" ,BLC.IS_BONUS_BY_COMBO");r.push(" ,BLC.LOW_QTY");r.push(" ,C.NAME_COMBO");r.push(" ,C.DESCRIPTION_COMBO");r.push(" ,BLC.PROMO_ID");r.push(" ,BLC.PROMO_NAME");r.push(" ,BLC.PROMO_TYPE");r.push(" ,BLC.FREQUENCY");r.push(" FROM BONUS_LIST_BY_COMBO BLC");r.push(" INNER JOIN COMBO C ");r.push(" ON (C.COMBO_ID = BLC.COMBO_ID)");r.push(" WHERE BLC.BONUS_LIST_ID = "+n.bonusListId);r.push(" ORDER BY BLC.COMBO_ID");i.executeSql(r.join(""),[],function(i,r){for(var f,u,o=[],e=0;e<r.rows.length;e++)f=r.rows.item(e),u=new BonoPorCombo,u.bonusListId=f.BONUS_LIST_ID,u.comboId=f.COMBO_ID,u.bonusType=f.BONUS_TYPE,u.bonusSubType=f.BONUS_SUB_TYPE,u.isBonusByLowPurchase=f.IS_BONUS_BY_LOW_PURCHASE,u.isBonusByCombo=f.IS_BONUS_BY_COMBO,u.lowQty=f.LOW_QTY,u.nameCombo=f.NAME_COMBO,u.descriptionCombo=f.DESCRIPTION_COMBO,u.isConfig=!1,u.isEmpty=u.bonusSubType===SubTipoDeBonificacionPorCombo.Unica.toString(),u.promoId=f.PROMO_ID,u.promoName=f.PROMO_NAME,u.promoType=f.PROMO_TYPE,u.frequency=f.FREQUENCY,u.skusPorCombo=[],u.skusDeBonoPorCombo=[],u.skusDeBonoPorComboAsociados=[],o.push(u);n.bonoPorCombos=o;t(n)});r=null},function(n){i({codigo:-1,mensaje:"Error al obtener el bonificaciones por combo del cliente: "+n.message})})},n.prototype.formarBonificacionPorCombo=function(n,t,i,r){var f=this,u;try{t<n.bonoPorCombos.length?this.obtenerSkusDeCombo(n.bonoPorCombos[t],function(u){f.obtenerSkusDeComboParaBonificar(u,function(u){n.bonoPorCombos[t]=u;f.formarBonificacionPorCombo(n,t+1,function(n){i(n)},function(n){r(n)})},function(n){r(n)})},function(n){r(n)}):i(n)}catch(e){u=new Operacion;u.codigo=-1;u.mensaje=e.message;console.log(u.mensaje);r(u)}},n.prototype.obtenerCombosPorCliente=function(n,t,i){var u=this,r;try{this.obtenerReglasDeBonificacionDeCombosPorCliente(n,function(n){u.formarBonificacionPorCombo(n,0,function(n){t(n)},function(n){i(n)})},function(n){i(n)})}catch(f){r=new Operacion;r.codigo=-1;r.mensaje=f.message;console.log(r.mensaje);i(r)}},n}();